---
title: "Configuring the Block Producer"
sidebar_label: "Configuring the Block Producer"
slug: /ConfiguringBlockProducer
hide_title: false
hide_table_of_contents: true
sidebar_position: 30
description: ""
---

import React from 'react';

import useBaseUrl from '@docusaurus/useBaseUrl';

import TestnetNote from '@site/src/components/TestnetNote.js';

import CodeBlock from '@theme/CodeBlock';
import queryTip from '!!raw-loader!/txt/queryTip.sh';

export function HTMLContent() {
  return (
    <div>

      {/* INSERT HTML HERE */}

      <p>To operate a stake pool, in addition to a wallet you need to generate the following key pairs and related files:</p>

      <ul>
        <li><b>Key-evolving Signature (KES) Hot Keys</b>—Used to validate the operational certificate for a stake pool, verifying that the pool has the authority to run. You must generate a new KES key pair and operational certificate every 90 days. Generating an operational certificate uses an incrementing counter file to count how many operational certificates your stake pool uses.</li>
        <li><b>Cold Keys</b>—Used to register a stake pool; update registration certificate parameters; rotate KES keys and operational certificates; and, retire a stake pool.</li>
        <li><b>Verifiable Random Function (VRF) Hot Keys</b>—Used to determine when a block-producing node is elected to prepare a block</li>
      </ul>

      <p>For more details, see <a href="https://developers.cardano.org/docs/operate-a-stake-pool/cardano-key-pairs/" target="_blank">Cardano Key Pairs</a>.</p>

      <p>The <i>How to Set Up a Cardano Stake Pool</i> guide uses the following file names throughout for the stake pool key pairs and related files:</p>

      <ul>
        <li><b>KES Keys</b>—<code>kes.vkey</code> and <code>kes.skey</code></li>
        <li><b>Operational Certificate</b>—<code>node.cert</code></li>
        <li><b>Incrementing Counter File</b>—<code>node.counter</code></li>
        <li><b>Cold Keys</b>—<code>node.vkey</code> and <code>node.skey</code></li>
        <li><b>Stake Pool Registration Certificate</b>—<code>pool.cert</code></li>
        <li><b>VRF Keys</b>—<code>vrf.vkey</code> and <code>vrf.skey</code></li>
      </ul>

      <TestnetNote />

      <p class="pi">To generate a KES key pair:</p>
      
      <ul class="ss">
        <li>On the computer designated as the block-producing node in your stake pool configuration, type the following commands using a terminal window:
          <CodeBlock language="bash">
            {`cd $NODE_HOME
cardano-cli conway node key-gen-KES \\
  --verification-key-file kes.vkey \\
  --signing-key-file kes.skey`}
          </CodeBlock>
        </li>
      </ul>

      <p class="pi">To generate a cold key pair and incrementing counter file:</p>

      <ol>
        <li>On your air-gapped, offline computer type the following commands using a terminal window:
          <CodeBlock language="bash">
            {`mkdir $HOME/cold-keys
cd $HOME/cold-keys
cardano-cli conway node key-gen \\
  --cold-verification-key-file $HOME/cold-keys/node.vkey \\
  --cold-signing-key-file $HOME/cold-keys/node.skey \\
  --operational-certificate-issue-counter $HOME/cold-keys/node.counter`}
          </CodeBlock>
          <table class="box">
            <tbody>
              <tr>
                <td class="boxLabel"><p class="boxLabel">Important<br /><img src={useBaseUrl('img/BoxImportant.png')} alt="Important" /></p></td>
                <td class="boxText"><p class="boxText">To ensure that your Cardano stake pool operating on Mainnet remains secure, do NOT use or store the <code>node.skey</code> secret signing key file for your stake pool on a computer that connects to a network or the Internet.</p></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>Carefully back up the cold keys that you generated in step 1 using a secure and comprehensive backup strategy.
          <table class="box">
            <tbody>
              <tr>
                <td class="boxLabel"><p class="boxLabel">Important<br /><img src={useBaseUrl('img/BoxImportant.png')} alt="Important" /></p></td>
                <td class="boxText"><p class="boxText">If you lose the cold keys, then you permanently lose access to your stake pool.</p></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>Using removable media, copy the <code>$HOME/cold-keys/node.vkey</code> public verification key file to the <code>$NODE_HOME</code> folder on the computer designated as the block-producing node in your stake pool configuration.</li>
      </ol>

      <p class="pi">To generate an operational certificate:</p>

      <ol>
        <li>To verify that the Cardano Node instance designated as the block producer in your stake pool configuration is fully synchronized with the network, confirm that the values of the <code>cardano.node.metrics.epoch.int</code> and <code>cardano.node.metrics.slotInEpoch.int</code> EKG metrics are equal to the current network epoch and slot values available using a Cardano <a href="https://explorer.cardano.org/" target="_blank">blockchain explorer</a>.</li>
        <li>To calculate the current KES period:
          <ol>
            <li>On the computer designated as the block-producing node in your stake pool configuration, type the following commands using a terminal window to retrieve the number of slots per KES period for your environment using the Shelley Genesis file:
              <CodeBlock language="bash">
                {`slotsPerKESPeriod=$(cat $NODE_HOME/shelley-genesis.json | jq -r '.slotsPerKESPeriod')
echo slotsPerKESPeriod: $\{slotsPerKESPeriod\}`}
              </CodeBlock>
            </li>
            <li>To query the slot number of the tip of the local copy of the Cardano blockchain since the beginning of the ledger, type:
              <CodeBlock language="bash">
            {queryTip}
          </CodeBlock>
            </li>
            <li>To divide the current slot tip by the number of slots per KES period, type:
              <CodeBlock language="bash">
                {`currentKesPeriod=$(( $\{currentSlot\} / $\{slotsPerKESPeriod\} ))
echo currentKesPeriod: $\{currentKesPeriod\}`}
              </CodeBlock>
            </li>
          </ol>
        </li>
        <li>Using removable media, copy the <code>$NODE_HOME/kes.vkey</code> file from the computer designated as the block-producing node in your stake pool configuration to <code>$NODE_HOME/kes.vkey</code> on the air-gapped, offline computer.</li>
        <li>On the air-gapped, offline computer, using a terminal window type the following command where <code>&lt;currentKesPeriod&gt;</code> is the value that you calculated in step 2:
          <CodeBlock language="bash">
            {`cardano-cli conway node issue-op-cert \\
  --kes-verification-key-file $NODE_HOME/kes.vkey \\
  --cold-signing-key-file $HOME/cold-keys/node.skey \\
  --operational-certificate-issue-counter $HOME/cold-keys/node.counter \\
  --kes-period <currentKesPeriod> \\
  --out-file $NODE_HOME/node.cert`}
          </CodeBlock>
        </li>
        <li>Using removable media, copy the <code>$NODE_HOME/node.cert</code> file to <code>$NODE_HOME/node.cert</code> on the computer designated as the block-producing node in your stake pool configuration.</li>
      </ol>

      <p>For more details, see the topic <a href="/IssuingOpCert">Issuing a New Operational Certificate</a>.</p>

      <p class="pi">To generate a VRF key pair:</p>

      <ol>
        <li>On the computer designated as the block-producing node in your stake pool configuration, using a terminal window type:
          <CodeBlock language="bash">
            {`cd $NODE_HOME
cardano-cli conway node key-gen-VRF \\
  --verification-key-file vrf.vkey \\
  --signing-key-file vrf.skey`}
          </CodeBlock>
        </li>
        <li>To secure the secret key file, type:
          <CodeBlock language="bash">
            {`chmod 400 vrf.skey`}
          </CodeBlock>
        </li>
        <li>Using removable media, copy the <code>$NODE_HOME/vrf.vkey</code> file to <code>$NODE_HOME/vrf.vkey</code> on the air-gapped, offline computer.</li>
      </ol>

      <p class="pi">To configure a Cardano Node instance to operate as a block producer:</p>

      <ol>
        <li>On the computer designated as the block-producing node in your stake pool configuration, type the following command to stop the Cardano Node instance:
          <CodeBlock language="bash">
            {`sudo systemctl stop cardano-node`}
          </CodeBlock>
        </li>
        <li>To retrieve the value of the <code>$NODE_HOME</code> environment variable, type:
          <CodeBlock language="bash">
            {`echo $NODE_HOME`}
          </CodeBlock>
        </li>
        <li>Using a text editor, open the <code>$NODE_HOME/startCardanoNode.sh</code> file.</li>
        <li>In the <code>startCardanoNode.sh</code> file, add or edit the following lines as needed, where <code>&lt;NodeHomeValue&gt;</code> is the value of your <code>$NODE_HOME</code> environment variable that you retrieved in step 2:
          <CodeBlock language="bash">
            {`# Set a variable to indicate the file path to the KES secret key file
KES=<NodeHomeValue>/kes.skey
# Set a variable to indicate the file path to the VRF secret key file
VRF=<NodeHomeValue>/vrf.skey
# Set a variable to indicate the file path to the operational certificate file
CERT=<NodeHomeValue>/node.cert
#
# Run Cardano Node using the options that you set using variables
#
/usr/local/bin/cardano-node run \\
  --topology $\{TOPOLOGY\} \\
  --database-path $\{DB_PATH\} \\
  --socket-path $\{SOCKET_PATH\} \\
  --host-addr $\{HOSTADDR\} \\
  --port $\{PORT\} \\
  --config $\{CONFIG\} \\
  --shelley-kes-key $\{KES\} \\
  --shelley-vrf-key $\{VRF\} \\
  --shelley-operational-certificate $\{CERT\}`}
          </CodeBlock>
        </li>
        <li>Save and close the <code>startCardanoNode.sh</code> file.</li>
        <li>To start the block-producing node in your stake pool configuration, type:
          <CodeBlock language="bash">
            {`sudo systemctl start cardano-node`}
          </CodeBlock>
        </li>
        <li>To confirm that the Cardano Node instance is operating as a block producer, verify that the <code>cardano.node.metrics.forging_enabled</code> EKG metric displays the value <code>1</code></li>
      </ol>

      <h1>Summarizing Security Considerations</h1>

      <p>As explained in the procedures above, on the block-producing node in your stake pool configuration store ONLY the following stake pool key and operational certificate files:</p>

      <ul>
        <li><code>kes.vkey</code></li>
        <li><code>kes.skey</code></li>
        <li><code>vrf.vkey</code></li>
        <li><code>vrf.skey</code></li>
        <li><code>node.vkey</code></li>
        <li><code>node.cert</code></li>
      </ul>

      <p>Copy NO stake pool key or operational certificate files from the air-gapped, offline computer or block-producing node to computers designated as relay nodes in your stake pool configuration.</p>

    </div>
  );
}

<HTMLContent />

