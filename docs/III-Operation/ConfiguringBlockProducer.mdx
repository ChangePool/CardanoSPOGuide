---
title: "Configuring the Block Producer"
sidebar_label: "Configuring the Block Producer"
slug: /ConfiguringBlockProducer
hide_title: false
hide_table_of_contents: true
sidebar_position: 30
description: ""
---

import React from 'react';

export function HTMLContent() {
  return (
    <div>

      {/* INSERT HTML HERE */}

      <p>To operate a stake pool, in addition to a wallet you need to generate the following key pairs and related files:</p>

      <ul>
        <li><b>Key-evolving Signature (KES) Hot Keys</b>—Used to validate the operational certificate for a stake pool, verifying that the pool has the authority to run. You must generate a new KES key pair and operational certificate every 90 days. Generating an operational certificate uses an incrementing counter file to count how many operational certificates your stake pool uses.</li>
        <li><b>Cold Keys</b>—Used to register a stake pool; update registration certificate parameters; rotate KES keys and operational certificates; and, retire a stake pool.</li>
        <li><b>Verifiable Random Function (VRF) Hot Keys</b>—Used to determine when a block-producing node is elected to prepare a block</li>
      </ul>

      <p>For more details, see <a href="https://developers.cardano.org/docs/operate-a-stake-pool/cardano-key-pairs/" target="_blank">Cardano Key Pairs</a>.</p>

      <p>The <i>How to Set Up a Cardano Stake Pool</i> guide uses the following file names throughout for the stake pool key pairs and related files:</p>

      <ul>
        <li><b>KES Keys</b>—<code>kes.vkey</code> and <code>kes.skey</code></li>
        <li><b>Operational Certificate</b>—<code>node.cert</code></li>
        <li><b>Incrementing Counter File</b>—<code>node.counter</code></li>
        <li><b>Cold Keys</b>—<code>node.vkey</code> and <code>node.skey</code></li>
        <li><b>Stake Pool Registration Certificate</b>—<code>pool.cert</code></li>
        <li><b>VRF Keys</b>—<code>vrf.vkey</code> and <code>vrf.skey</code></li>
      </ul>

      <p class="pi">To generate a KES key pair:</p>
      
      <ul class="ss">
        <li>On the computer designated as the block-producing node in your stake pool configuration, type the following commands using a terminal window:
          <pre>
            cd $NODE_HOME<br />
            cardano-cli conway node key-gen-KES \<br />
            &nbsp;&nbsp;--verification-key-file kes.vkey \<br />
            &nbsp;&nbsp;--signing-key-file kes.skey
          </pre>
        </li>
      </ul>

      <p class="pi">To generate a cold key pair and incrementing counter file:</p>

      <ol>
        <li>On your air-gapped, offline computer type the following commands using a terminal window:
          <pre>
            mkdir $HOME/cold-keys<br />
            cd $HOME/cold-keys<br />
            cardano-cli conway node key-gen \<br />
            &nbsp;&nbsp;--cold-verification-key-file $HOME/cold-keys/node.vkey \<br />
            &nbsp;&nbsp;--cold-signing-key-file $HOME/cold-keys/node.skey \<br />
            &nbsp;&nbsp;--operational-certificate-issue-counter $HOME/cold-keys/node.counter
          </pre>
          <table class="box">
            <tbody>
              <tr>
                <td class="boxLabel"><p class="boxLabel">Important<br /><img src="img/BoxImportant.png" alt="Important" /></p></td>
                <td class="boxText"><p class="boxText">To ensure that your Cardano stake pool operating on Mainnet remains secure, do NOT use or store the <code>node.skey</code> secret signing key file for your stake pool on a computer that connects to a network or the Internet.</p></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>Carefully back up the cold keys that you generated in step 1 using a secure and comprehensive backup strategy.
          <table class="box">
            <tbody>
              <tr>
                <td class="boxLabel"><p class="boxLabel">Important<br /><img src="img/BoxImportant.png" alt="Important" /></p></td>
                <td class="boxText"><p class="boxText">If you lose the cold keys, then you permanently lose access to your stake pool.</p></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>Using removable media, copy the <code>$HOME/cold-keys/node.vkey</code> public verification key file to the <code>$NODE_HOME</code> folder on the computer designated as the block-producing node in your stake pool configuration.</li>
      </ol>

      <p class="pi">To generate an operational certificate:</p>

      <ol>
        <li>To verify that the Cardano Node instance designated as the block producer in your stake pool configuration is fully synchronized with the network, confirm that the values of the <code>cardano.node.metrics.epoch.int</code> and <code>cardano.node.metrics.slotInEpoch.int</code> EKG metrics are equal to the current network epoch and slot values available using a Cardano <a href="https://explorer.cardano.org/" target="_blank">blockchain explorer</a>.</li>
        <li>To calculate the current KES period:
          <ol>
            <li>On the computer designated as the block-producing node in your stake pool configuration, type the following commands using a terminal window to retrieve the number of slots per KES period for your environment using the Shelley Genesis file:
              <pre>
                slotsPerKESPeriod=$(cat $NODE_HOME/shelley-genesis.json | jq -r '.slotsPerKESPeriod')<br />
                echo slotsPerKESPeriod: $&#123;slotsPerKESPeriod&#125;<br />
              </pre></li>
              <li>To query the slot number of the tip of the local copy of the Cardano blockchain since the start of the ledger, type:
                <pre>
                  slotNo=$(cardano-cli conway query tip --mainnet | jq -r '.slot')<br />
                  echo slotNo: $&#123;slotNo&#125;
                </pre>
              <table class="box">
                <tbody>
                  <tr>
                    <td class="boxLabel"><p class="boxLabel">Note<br /><img src="img/BoxNote.png" alt="Note" /></p></td>
                    <td class="boxText"><p class="boxText">The <code>cardano-cli conway query tip</code> command uses the <code>CARDANO_NODE_SOCKET_PATH</code> environment variable that you set in the <code>$HOME/.bashrc</code> file when <a href="/GHC">Installing GHC and Cabal</a>. <code>cardano-cli</code> commands throughout the <i>How to Set Up a Cardano Stake Pool</i> guide may use the <code>CARDANO_NODE_SOCKET_PATH</code> environment variable. If you do not set the <code>CARDANO_NODE_SOCKET_PATH</code> environment variable, then you need to set the <code>--socket-path</code> option explicitly in each command requiring the location of the Cardano node socket file.</p></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>To divide the current slot tip by the number of slots per KES period, type:
              <pre>
                currentKesPeriod=$(($&#123;slotNo&#125; / $&#123;slotsPerKESPeriod&#125;))<br />
                echo currentKesPeriod: $&#123;currentKesPeriod&#125;
              </pre>
            </li>
          </ol>
        </li>
        <li>Using removable media, copy the <code>$NODE_HOME/kes.vkey</code> from the computer designated as the block-producing node in your stake pool configuration to <code>$NODE_HOME/kes.vkey</code> on the air-gapped, offline computer.</li>
        <li>On the air-gapped, offline computer, using a terminal window type the following command where <code>&lt;currentKesPeriod&gt;</code> is the value that you calculated in step 2:
          <pre>
            cardano-cli conway node issue-op-cert \<br />
            &nbsp;&nbsp;--kes-verification-key-file $NODE_HOME/kes.vkey \<br />
            &nbsp;&nbsp;--cold-signing-key-file $HOME/cold-keys/node.skey \<br />
            &nbsp;&nbsp;--operational-certificate-issue-counter $HOME/cold-keys/node.counter \<br />
            &nbsp;&nbsp;--kes-period &lt;currentKesPeriod&gt; \<br />
            &nbsp;&nbsp;--out-file $NODE_HOME/node.cert
          </pre>
        </li>
        <li>Using removable media, copy the <code>$NODE_HOME/node.cert</code> file to <code>$NODE_HOME/node.cert</code> on the computer designated as the block-producing node in your stake pool configuration.</li>
      </ol>

      <p>For more details, see the topic <a href="/IssuingOpCert">Issuing a New Operational Certificate</a>.</p>

      <p class="pi">To generate a VRF key pair:</p>

      <ol>
        <li>On the computer designated as the block-producing node in your stake pool configuration, using a terminal window type:
          <pre>
            cd $NODE_HOME<br />
            cardano-cli conway node key-gen-VRF \<br />
            &nbsp;&nbsp;--verification-key-file vrf.vkey \<br />
            &nbsp;&nbsp;--signing-key-file vrf.skey
          </pre>
        </li>
        <li>To secure the secret key file, type:
          <pre>
            chmod 400 vrf.skey
          </pre>
        </li>
        <li>Using removable media, copy the <code>$NODE_HOME/vrf.vkey</code> file to <code>$NODE_HOME/vrf.vkey</code> on the air-gapped, offline computer.</li>
      </ol>

      <p class="pi">To configure a Cardano Node instance to operate as a block producer:</p>

      <ol>
        <li>On the computer designated as the block-producing node in your stake pool configuration, type the following command to stop the Cardano Node instance:
          <pre>
            sudo systemctl stop cardano-node
          </pre>
        </li>
        <li>To retrieve the value of the <code>$NODE_HOME</code> environment variable, type:
          <pre>
            echo $NODE_HOME
          </pre>
        </li>
        <li>Using a text editor, open the <code>$NODE_HOME/startCardanoNode.sh</code> file.</li>
        <li>In the <code>startCardanoNode.sh</code> file, add or edit the following lines as needed, where <code>&lt;NodeHomeValue&gt;</code> is the value of your <code>$NODE_HOME</code> environment variable that you retrieved in step 2:
          <pre>
            # Set a variable to indicate the file path to the KES secret key file<br />
            KES=&lt;NodeHomeValue&gt;/kes.skey<br />
            # Set a variable to indicate the file path to the VRF secret key file<br />
            VRF=&lt;NodeHomeValue&gt;/vrf.skey<br />
            # Set a variable to indicate the file path to the operational certificate file<br />
            CERT=&lt;NodeHomeValue&gt;/node.cert<br />
            #<br />
            # Run Cardano Node using the options that you set using variables<br />
            #<br />
            /usr/local/bin/cardano-node run \<br />
            &nbsp;&nbsp;--topology $&#123;TOPOLOGY&#125; \<br />
            &nbsp;&nbsp;--database-path $&#123;DB_PATH&#125; \<br />
            &nbsp;&nbsp;--socket-path $&#123;SOCKET_PATH&#125; \<br />
            &nbsp;&nbsp;--host-addr $&#123;HOSTADDR&#125; \<br />
            &nbsp;&nbsp;--port $&#123;PORT&#125; \<br />
            &nbsp;&nbsp;--config $&#123;CONFIG&#125; \<br />
            &nbsp;&nbsp;--shelley-kes-key $&#123;KES&#125; \<br />
            &nbsp;&nbsp;--shelley-vrf-key $&#123;VRF&#125; \<br />
            &nbsp;&nbsp;--shelley-operational-certificate $&#123;CERT&#125;
          </pre>
        </li>
        <li>Save and close the <code>startCardanoNode.sh</code> file.</li>
        <li>To start the block-producing node in your stake pool configuration, type:
          <pre>
            sudo systemctl start cardano-node
          </pre>
        </li>
        <li>To confirm that the Cardano Node instance is operating as a block producer, verify that the <code>cardano.node.metrics.forging_enabled</code> EKG metric displays the value <code>1</code></li>
      </ol>

      <h1>Summarizing Security Considerations</h1>

      <p>As explained in the procedures above, on the block-producing node in your stake pool configuration store ONLY the following stake pool key and operational certificate files:</p>

      <ul>
        <li><code>kes.vkey</code></li>
        <li><code>kes.skey</code></li>
        <li><code>vrf.vkey</code></li>
        <li><code>vrf.skey</code></li>
        <li><code>node.vkey</code></li>
        <li><code>node.cert</code></li>
      </ul>

      <p>Copy NO stake pool key or operational certificate files from the air-gapped, offline computer or block-producing node to computers designated as relay nodes in your stake pool configuration.</p>

    </div>
  );
}

<HTMLContent />

