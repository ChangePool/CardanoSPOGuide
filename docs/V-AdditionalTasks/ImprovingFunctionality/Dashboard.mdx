---
title: "Creating a Graphical Dashboard"
sidebar_label: "Creating a Graphical Dashboard"
slug: /Dashboard
hide_title: false
hide_table_of_contents: true
sidebar_position: 20
description: ""
---

import React from 'react';

import useBaseUrl from '@docusaurus/useBaseUrl';

import CodeBlock from '@theme/CodeBlock';

export function HTMLContent() {
  return (
    <div>

      {/* INSERT HTML HERE */}

      <p>You can create a graphical dashboard to monitor a Cardano stake pool that you operate using the following open source software solutions:</p>

      <ul>
        <li><a href="https://prometheus.io/" target="_blank">Prometheus</a> collects time-series data—metrics—from applications and infrastructure using a pull model, facilitating continuous system monitoring as well as alerting.</li>
        <li><a href="https://github.com/prometheus/node_exporter" target="_blank">Prometheus Node Exporter</a> enables exporting system hardware and operating system metrics for a host computer using Prometheus. Additionally, enabling a textfile collector allows you to export any custom metrics that you may generate.</li>
        <li><a href="https://grafana.com/" target="_blank">Grafana</a> is an observability platform that facilitates visualizing data Prometheus collects.</li>
      </ul>

      <p><i>Figure 1</i> provides a network diagram illustrating how Prometheus and Grafana components may connect and interact in a configuration involving multiple computers, such as when monitoring a Cardano stake pool. The diagram includes default port numbers.</p>

      <figure>
        <img src="img/PrometheusNetworkDiagram.png" />
        <figcaption>Figure 1 Prometheus and Grafana Network Diagram</figcaption>
      </figure>

      <p>To allow Prometheus and Grafana components to communicate, you must open required ports to specific computers using respective firewalls.</p>

      <p>To monitor a Cardano stake pool configuration, you may install the Prometheus and Grafana servers on the same relay node along with Prometheus Node Exporter, for example. Configure Prometheus to scrape each instance of Prometheus Node Exporter, as well as each Cardano Node Prometheus endpoint. For more details, see <i>Figure 2</i>.</p>

      <figure>
        <img src="img/GUIDashboardNetworkDiagram.png" />
        <figcaption>Figure 2 Cardano Stake Pool Graphical Dashboard Network Diagram</figcaption>
      </figure>

      <table class="box">
        <tbody>
          <tr>
            <td class="boxLabel"><p class="boxLabel">Note<br /><img src="img/BoxNote.png" alt="Note" /></p></td>
            <td class="boxText"><p class="boxText">For details on using the Cardano Node Prometheus endpoint, see <a href="/MonitoringMetrics">Monitoring Metrics</a>. The following procedure assumes that Cardano Node Prometheus endpoints in your stake pool configuration listen on the default port 12798. If you change the port number, then update the procedure accordingly.</p></td>
          </tr>
        </tbody>
      </table>

      <p>To connect to the Prometheus and Grafana servers securely as an end user, consider <a href="/Hardening/SSH#Using-Port-Forwarding">Using Port Forwarding</a>.</p>

      <h1>Installing and Configuring Prometheus</h1>

      <p class="pi">To install and configure Prometheus to monitor a Cardano stake pool:</p>

      <ol>
        <li>On the computer that you designate to host the Prometheus server, type the following commands using a terminal window:
          <CodeBlock language="bash">
            {`sudo apt-get update -y
sudo apt-get upgrade -y
sudo apt-get install prometheus
sudo systemctl start prometheus.service
sudo systemctl enable prometheus.service
sudo systemctl status prometheus.service`}
          </CodeBlock>
        </li>
        <li>Using a text editor, open the <code>config*.json</code> file for the Cardano Node instance, and then edit the following key to set the IP address where the local Cardano Node Prometheus endpoint listens:
          <CodeBlock language="bash">
          {`"hasPrometheus": [
  "0.0.0.0",
  12798
]`}
          </CodeBlock>
          <table class="box">
            <tbody>
              <tr>
                <td class="boxLabel"><p class="boxLabel">Note<br /><img src="img/BoxNote.png" alt="Note" /></p></td>
                <td class="boxText"><p class="boxText">When a server binds to <code>0.0.0.0</code>, the server listens on every IP address assigned to the computer.</p></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>Save and close the <code>config*.json</code> file.</li>
        <li>To restart the local Cardano Node instance, type:
          <CodeBlock language="bash">
            {`sudo systemctl restart cardano-node.service`}
          </CodeBlock>
        </li>
        <li>To verify that Prometheus endpoint metrics for the local Cardano Node instance are available, using a Web browser navigate to <b>http://localhost:12798/metrics</b>
          <center><strong>OR</strong></center>
        Using a terminal window, type:
        <CodeBlock language="bash">
          {`curl -s http://localhost:12798/metrics`}
        </CodeBlock></li>
        <li>To install Prometheus Node Exporter, type:
          <CodeBlock language="bash">
            {`sudo apt-get install prometheus-node-exporter
sudo systemctl start prometheus-node-exporter.service
sudo systemctl enable prometheus-node-exporter.service
sudo systemctl status prometheus-node-exporter.service`}
          </CodeBlock>
        </li>
        <li>On the computer where you installed Prometheus Node Exporter in step 6, in the firewall open ports 12798 and 9100 to incoming traffic. If you use UFW, then follow the commands to open a port in <a href="/Hardening/Firewall#Configuring-Uncomplicated-Firewall">Configuring Uncomplicated Firewall</a> updating the port numbers as needed.
          <table class="box">
            <tbody>
              <tr>
                <td class="boxLabel"><p class="boxLabel">Important<br /><img src="img/BoxImportant.png" alt="Important" /></p></td>
                <td class="boxText"><p class="boxText">On the computer hosting the Prometheus server, opening ports 12798 and 9100 is NOT needed.</p></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>Repeat steps 2 to 7 on each computer in your stake pool configuration.</li>
        <li>To configure Prometheus scrape targets:
          <ol>
            <li>On the computer where you installed Prometheus in step 1, using a terminal window type:
              <CodeBlock language="bash">
                {`cd /etc/prometheus
sudo cp ./prometheus.yml ./prometheus.bak
sudo nano ./prometheus.yml`}
              </CodeBlock>
            </li>
            <li>In the <code>prometheus.yml</code> file, add an entry in the <code>scrape_configs</code> section for each Cardano Node instance and Prometheus Node Exporter instance in your stake pool configuration, using the following example as a template where <code>&lt;BlockProducingNodeIPAddress&gt;</code> is the IP address of the block-producing node in your stake pool configuration:
              <CodeBlock language="bash">
                {`global:
  scrape_interval:     15s # By default, scrape targets every 15 seconds.

  ...

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  # The job name is added as a label job=<job_name> to any timeseries scraped from this config.
  - job_name: 'stakepool'

    static_configs:

      - targets: ['localhost:12798']
        labels:
          alias: 'Relay 1'
          type:  'cardano-node'
	
      - targets: ['localhost:9100']
        labels:
          alias: 'Relay 1'
          type:  'prometheus-node-exporter'

      - targets: ['<BlockProducingNodeIPAddress>:12798']
        labels:
          alias: 'Block Producer'
          type:  'cardano-node'
		  
      - targets: ['<BlockProducingNodeIPAddress>:9100']
        labels:
          alias: 'Block Producer'
          type:  'prometheus-node-exporter'`}
              </CodeBlock>
              <table class="box">
                <tbody>
                  <tr>
                    <td class="boxLabel"><p class="boxLabel">Note<br /><img src="img/BoxNote.png" alt="Note" /></p></td>
                    <td class="boxText"><p class="boxText">For more details on configuring Prometheus, see <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/" target="_blank">Configuration</a>.</p></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>Save and close the <code>prometheus.yml</code> file.</li>
            <li>To restart Prometheus, type:
              <CodeBlock language="bash">
                {`sudo systemctl restart prometheus.service`}
              </CodeBlock>
            </li>
          </ol>
        </li>
        <li>To verify that Prometheus is scraping the desired targets:
          <ol>
            <li>Using a Web browser on the computer where you installed Prometheus in step 1, navigate to <b>http://localhost:9090</b></li>
            <li>In the Prometheus Web user interface that displays, click the drop-down arrow next to the <b>Status</b> item in the top navigation bar, and then click <b>Targets</b></li>
            <li>Confirm that each target you configured in step 9 lists as an <b>Endpoint</b>, and that the value in the <b>State</b> field for each target is <b>UP</b></li>
          </ol>
        </li>
        <li>In Prometheus, storing and querying data is achieved using PromQL (Prometheus Query Language). To execute a basic PromQL query, in the Prometheus Web user interface click <b>Graph</b>, then click the drop-down arrow next to the <b>Insert Metric at Cursor</b> field, then in the list of metrics click the metric that you want to query, and then click the <b>Execute</b> button.</li>
      </ol>

      <p>In query results, time-series data for metrics display on the <b>Graph</b> tab. Current values for metrics display on the <b>Console</b> tab.</p>
      
      <p>If a PromQL query does not filter targets and data satisfying the query are available for multiple targets, then query results include the data from all applicable targets.</p>

      <table class="box">
        <tbody>
          <tr>
            <td class="boxLabel"><p class="boxLabel">Note<br /><img src="img/BoxNote.png" alt="Note" /></p></td>
            <td class="boxText"><p class="boxText">In PromQL, filter queries using curly braces (<code>&#123;</code> and <code>&#125;</code>). For more details, see <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/" target="_blank">Querying Basics</a>.</p></td>
          </tr>
        </tbody>
      </table>

      <h1>Enabling a Textfile Collector</h1>

      <p class="pi">To enable a Prometheus Node Exporter textfile collector:</p>

      <ol>
        <li>To create a folder for the textfile collector to parse, using a terminal window on a computer having Prometheus Node Exporter installed, type:
          <CodeBlock language="bash">
            {`sudo mkdir /var/lib/prometheus/node-exporter/textfile-collector`}
          </CodeBlock>
        </li>
        <li>To configure Prometheus Node Exporter to parse the folder that you created in step 1, type:
          <CodeBlock language="bash">
            {`cd /lib/systemd/system
sudo cp prometheus-node-exporter.service prometheus-node-exporter.service.bak
sudo nano prometheus-node-exporter.service`}
          </CodeBlock>
        </li>
        <li>In the <code>prometheus-node-exporter.service</code> file, edit the following line:
        <CodeBlock language="bash">
          {`ExecStart=/usr/bin/prometheus-node-exporter --collector.textfile --collector.textfile.directory=/var/lib/prometheus/node-exporter/textfile-collector $ARGS`}
        </CodeBlock></li>
        <li>Save and close the <code>prometheus-node-exporter.service</code> file.</li>
        <li>To restart Prometheus Node Exporter, type:
          <CodeBlock language="bash">
            {`sudo systemctl daemon-reload
sudo systemctl restart prometheus-node-exporter.service`}
          </CodeBlock>
        </li>
        <li>To verify that Prometheus Node Exporter parses the folder that you created for the textfile collector, type the following command, and then ensure that no error messages associated with the textfile collector appear in the log file:
          <CodeBlock language="bash">
            {`journalctl -fu prometheus-node-exporter.service`}
          </CodeBlock>
        </li>
        <li>Repeat steps 1 to 6 on all computers in your stake pool configuration having Prometheus Node Exporter installed.</li>
      </ol>

      <h1>Using a Textfile Collector</h1>

      <p>The following procedure provides an example showing you how to use a Prometheus Node Exporter textfile collector to export—expose—any custom metrics that you may choose to generate.</p>

      <p>Prometheus Node Exporter parses all files in the directory specified as the textfile collector directory having a PROM file name extension. In PROM files, expose data using text-based <a href="https://prometheus.io/docs/instrumenting/exposition_formats/" target="_blank">Exposition Formats</a>.</p>

      <p class="pi">To export custom metrics using a textfile collector:</p>

      <ol>
        <li>On a computer hosting Cardano Node as well as Prometheus Node Exporter, to retrieve the value of the <code>$NODE_HOME</code> environment variable, using a terminal window type:
          <CodeBlock language="bash">
            {`echo $NODE_HOME`}
          </CodeBlock>
        </li>
        <li>Using a text editor, create a file named <code>$NODE_HOME/exportMetrics.sh</code> and then add the following lines, where <code>&lt;NodeHomeValue&gt;</code> is the value of the <code>$NODE_HOME</code> environment variable that you retrieved in step 1, to create a Bash script that exports the size of the directory on the local computer containing Cardano blockchain ledger data assigned to a metric named <code>cardano_db_size</code>:
          <CodeBlock language="bash">
            {`#!/bin/bash

# Assign the directory that the Prometheus Node Exporter textfile collector parses to a variable
textfileCollectorPath="/var/lib/prometheus/node-exporter/textfile-collector"

# Assign the size of the local directory containing Cardano blockchain ledger data to a variable
dbSize=$(du -s <NodeHomeValue>/db | cut -d $'\\t' -f 1)

# Using the format <MetricName> <Value> export to a temporary file the size of the local directory containing Cardano blockchain ledger data
echo "cardano_db_size $\{dbSize\}" > $\{textfileCollectorPath\}/exportMetrics.tmp

# To avoid partial scrapes, write metrics to files atomically using a temporary file, and then rename the file
mv $\{textfileCollectorPath\}/exportMetrics.tmp $\{textfileCollectorPath\}/exportMetrics.prom`}
          </CodeBlock>
        </li>
        <li>To set execute permissions for the <code>exportMetrics.sh</code> script, type:
        <CodeBlock language="bash">
          {`chmod +x $NODE_HOME/exportMetrics.sh`}
        </CodeBlock></li>
        <li>To run the <code>exportMetrics.sh</code> script, type:
          <CodeBlock language="bash">
            {`sudo $NODE_HOME/exportMetrics.sh`}
          </CodeBlock>
        </li>
        <li>To verify that the custom metric named <code>cardano_db_size</code> exports successfully, using a Web browser press <b>CTRL+F5</b> to perform a hard refresh of the Prometheus Web user interface, and then query the metric.</li>
      </ol>

      <table class="box">
        <tbody>
          <tr>
            <td class="boxLabel"><p class="boxLabel">Challenge<br /><img src="img/BoxChallenge.png" alt="Challenge" /></p></td>
            <td class="boxText"><p class="boxText">Create a cron job that regularly schedules running a script that exports custom metrics using a textfile collector. The cron job requires root privileges. To create a cron job that runs using root privileges, type:
              <CodeBlock language="bash">
                {`sudo crontab -e`}
              </CodeBlock></p>
            </td>            
          </tr>
        </tbody>
      </table>

      <h1>Installing and Configuring Grafana</h1>

      <p class="pi">To install Grafana:</p>

      <ol>
        <li>On the computer that you designate to host the Grafana server, type the following commands using a terminal window:
          <CodeBlock language="bash">
            {`# Install prerequisite packages
sudo apt-get install -y apt-transport-https wget
# Import the GPG key
sudo mkdir -p /etc/apt/keyrings/
wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg > /dev/null
# Add the repository for stable releases
echo "deb [arch=amd64 signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
# Update the list of available packages
sudo apt-get update
# Install open source Grafana software
sudo apt-get install grafana
# Configure Grafana to start when the computer starts
sudo systemctl daemon-reload
sudo systemctl enable grafana-server.service
# Start Grafana
sudo systemctl start grafana-server.service
# Verify that Grafana is running
sudo systemctl status grafana-server.service`}
          </CodeBlock>
          {/* <!-- Source: https://grafana.com/docs/grafana/latest/setup-grafana/installation/debian/ --> */}
        </li>
        <li>Using a Web browser on the computer hosting Grafana, navigate to <b>http://localhost:3000</b>
        <table class="box">
          <tbody>
            <tr>
              <td class="boxLabel"><p class="boxLabel">Note<br /><img src="img/BoxNote.png" alt="Note" /></p></td>
              <td class="boxText"><p class="boxText">If you are <a href="/Hardening/SSH#Using-Port-Forwarding">Using Port Forwarding</a>, then adjust the URL accordingly.</p></td>
            </tr>
          </tbody>
        </table></li>
        <li>On the Grafana Log In page, type <b>admin</b> in the <b>Email or Username</b> field, then type <b>admin</b> in the <b>Password</b> field, and then click the <b>Log In</b> button.</li>
        <li>When prompted, change the password.</li>
      </ol>

      <p class="pi">To add your Prometheus server as a data source in Grafana:</p>

      <ol>
        <li>On the Grafana Home page, click <b>Connections</b> in the left pane, and then click the <b>Add a New Connection</b> button in the right pane.</li>
        <li>In the Search field, type <b>Prometheus</b>, and then click the <b>Prometheus</b> plugin in the <b>Data Sources</b> area.</li>
        <li>In the top right corner of the Web page, click the <b>Add New Data Source</b> button.</li>
        <li>In the Name field, type <b>Prometheus</b></li>
        <li>In the Connection area, type <b>http://localhost:9090</b> in the <b>Prometheus Server URL</b> field.</li>
        <li>Scroll down to the bottom of the Web page, and then click the <b>Save & Test</b> button.</li>
      </ol>

      <p>If the test is successful, then Grafana displays the message <b>Successfully Queried the Prometheus API</b>.</p>

      <h1>Creating a Dashboard Using Grafana</h1>

      <p class="pi">To create a graphical dashboard for monitoring a Cardano stake pool:</p>

      <ol>
        <li>On the computer hosting the Grafana server, download the example <a href="txt/GrafanaDashboard.json">Grafana Dashboard</a> file.</li>
        <li>On the Grafana Home page, click <b>Dashboards</b> in the left pane, then click the dropdown arrow next to the <b>New</b> button in the top right corner of the right pane, and then click <b>Import</b></li>
        <li>Drag and drop the file named <b>GrafanaDashboard.json</b> that you downloaded in step 1 in the <b>Upload Dashboard JSON File</b> area on the <b>Import Dashboard</b> page.</li>
        <li>Click the <b>Change UID</b> button, and then clear the contents of the <b>Unique Identifier (UID)</b> field, and then click the <b>Import (Overwrite)</b> button.</li>
      </ol>

      <p><i>Figure 3</i> shows the example Grafana dashboard that you downloaded in the previous procedure.</p>

      <figure>
        <img src="img/GrafanaDashboard.jpg" />
        <figcaption>Figure 3 Example Grafana Dashboard</figcaption>
      </figure>

      <p>You can edit the appearance and PromQL queries retrieving data for panels that a Grafana dashboard displays.</p>

      <p class="pi">To edit a Grafana dashboard panel:</p>

      <ol>
        <li>When viewing a dashboard, click and drag the sizing handle in the bottom right corner of a panel to resize the panel.</li>
        <li>To edit a panel, click the three-dot menu in the top right corner of the panel, and then click <b>Edit</b></li>
        <li>On the Queries tab, edit PromQL queries as needed.
          <table class="box">
            <tbody>
              <tr>
                <td class="boxLabel"><p class="boxLabel">Important<br /><img src="img/BoxImportant.png" alt="Important" /></p></td>
                <td class="boxText"><p class="boxText">To troubleshoot data that a Grafana dashboard panel displays, test PromQL queries using the Prometheus Web user interface.</p></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>In the Visualization pane, edit the appearance of the panel as needed.</li>
        <li>To save revisions to a dashboard, click the <b>Save Dashboard</b> button in the top right corner of the Web page, then type a description of your edits in the <b>Message</b> field, and then click the <b>Save</b> button.</li>
      </ol>

      <h1>Additional Resources</h1>

      <p>For more details on creating Grafana dashboards, see the topic <a href="https://grafana.com/docs/grafana/latest/visualizations/" target="_blank">Visualize Data</a>.</p>

      <p>To explore some additional third-party Grafana dashboards available in the Cardano community, see <a href="/AppendixD">Appendix D: Community Projects</a>.</p>

    </div>
  );
}

<HTMLContent />

